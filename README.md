# Universal Document Converter

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ FastAPI, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Ñ–∏—Å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, PDF –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Markdown/JSON —Å –ø–æ–º–æ—â—å—é Docling. –°–µ—Ä–≤–∏—Å –≤–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä OCR-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (Tesseract CLI + EasyOCR), –æ—á–∏—Å—Ç–∫—É –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —à–∞–ø–æ–∫ –∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π —á–∞–Ω–∫–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞.

## üí° –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**: –≤—ã–±–æ—Ä –ø–∞–π–ø–ª–∞–π–Ω–∞ Docling –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (legacy —Ñ–æ—Ä–º–∞—Ç—ã —á–µ—Ä–µ–∑ LibreOffice, PDF/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ OCR-–ø–∞–π–ø–ª–∞–π–Ω, "—Ä–æ–¥–Ω—ã–µ" —Ñ–æ—Ä–º–∞—Ç—ã –Ω–∞–ø—Ä—è–º—É—é).
- **–ú—É–ª—å—Ç–∏-OCR**: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π OCR –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–≤—É–º—è –¥–≤–∏–∂–∫–∞–º–∏ (Tesseract CLI –∏ EasyOCR). –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —ç–≤—Ä–∏—Å—Ç–∏–∫–æ–π `score = –¥–ª–∏–Ω–∞ √ó (0.6 + 0.4 √ó –¥–æ–ª—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã)`.
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–æ–≤**: –∞–ª–∏–∞—Å—ã `ru`, `en`, `uk`, `kz` –∏ –¥—Ä. –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ –∫–æ–¥—ã Tesseract (`rus`, `eng`, ‚Ä¶) –∏ –¥–µ–¥—É–ø–ª–∏—Ä—É—é—Ç—Å—è, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
- **OCRmyPDF –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥**: –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —É—Ç–∏–ª–∏—Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è deskew/denoise/rotate-cleanup –ø–µ—Ä–µ–¥ OCR.
- **–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —à–∞–ø–æ–∫**: —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ "–ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã" —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π —á–∞–Ω–∫–∏–Ω–≥**: –¥–µ–ª–µ–Ω–∏–µ Markdown –Ω–∞ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è —á–∞–Ω–∫–∏ —Å —É—á—ë—Ç–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

## üß± –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

–°–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `Dockerfile` –∏ –≤–∫–ª—é—á–∞–µ—Ç:

- `tesseract-ocr`, `tesseract-ocr-rus`, `tesseract-ocr-eng`, `tesseract-ocr-osd`
- `libreoffice`, `poppler-utils`, `qpdf`, `ghostscript`
- `libgl1`, `libglib2.0-0`, `libsm6`, `libxext6`, `libxrender1`, `libgomp1` ‚Äî –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è EasyOCR/OpenCV
- `libmagic1`, `curl`, `ca-certificates`

### Python-–ø–∞–∫–µ—Ç—ã

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `requirements.txt`:

```text
fastapi>=0.110.0
uvicorn[standard]>=0.24.0
python-multipart>=0.0.7
pydantic>=2.6.0
pydantic-settings>=2.2.0
docling
easyocr>=1.7.1
ocrmypdf>=16.0.0
```

`easyocr` –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç `torch`, `opencv-python-headless`, `scikit-image` –∏ –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–º. `requirements-dev.txt` (pytest, mypy, pre-commit –∏ –¥—Ä.).

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
docker build -t universal-converter .
docker run -p 8088:8088 -e DOCLING_LANGS="rus,eng" universal-converter
```

Docker-–æ–±—Ä–∞–∑ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª–∏ Docling (–≤–∫–ª—é—á–∞—è EasyOCR), –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ `/convert` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π –≤ —Ä–∞–Ω—Ç–∞–π–º–µ.

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pip install -r requirements-dev.txt  # –ø–æ –∂–µ–ª–∞–Ω–∏—é
uvicorn app.main:app --reload --host 0.0.0.0 --port 8088
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------------------|----------|
| `UVICORN_HOST` | `0.0.0.0` | –•–æ—Å—Ç uvicorn |
| `UVICORN_PORT` | `8088` | –ü–æ—Ä—Ç uvicorn |
| `DOCLING_ARTIFACTS_PATH` | –Ω–µ –∑–∞–¥–∞–Ω–æ | –ü—É—Ç—å –∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º Docling (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ) |
| `DOCLING_TABLE_MODE` | `ACCURATE` | –†–µ–∂–∏–º –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü |
| `DOCLING_FORCE_OCR` | `false` | –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ OCR |
| `DOCLING_LANGS` | `rus,eng` | –Ø–∑—ã–∫–∏ OCR –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é; –∞–ª–∏–∞—Å—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ru` ‚Üí `rus`) |
| `MAX_FILE_SIZE_MB` | `80` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ |
| `HEADER_FILTER_CONFIG` | `config/header_filter.json` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ —à–∞–ø–æ–∫ |
| `OMP_NUM_THREADS` | `4` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ OpenMP –¥–ª—è Tesseract |

## üîç OCR-–ø–∞–π–ø–ª–∞–π–Ω—ã

1. **`no_ocr`** ‚Äì Docling –±–µ–∑ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ OCR; –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è PDF —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Å–ª–æ–µ–º.
2. **`force_ocr`** ‚Äì Docling + Tesseract CLI (`force_full_page_ocr=True`).
3. **`easyocr`** ‚Äì Docling + EasyOCR (russian+english –º–æ–¥–µ–ª–∏).

–ö–∞–∂–¥—ã–π –ø–∞–π–ø–ª–∞–π–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫—É (—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —à–∞–ø–æ–∫, —á–∏—Å—Ç–∫–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã). –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ –¥–ª–∏–Ω–µ —Ç–µ–∫—Å—Ç–∞ –∏ –¥–æ–ª–µ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã; –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–µ (`best_strategy`).

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
python -m pytest -q
```

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã:

- `tests/test_ocr_pdf.py::test_convert_ocr_image_pdf` ‚Äì synthetic PDF (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + —Ä—É—Å—Å–∫–∞—è –Ω–∞–¥–ø–∏—Å—å) —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–∞–±–æ—Ç—ã Tesseract –∏ EasyOCR.
- `tests/test_ocr_pdf.py::test_convert_real_russian_pdf` ‚Äì –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ú–ê–ò [[—Å—Å—ã–ª–∫–∞](https://mai.ru/upload/iblock/6f4/nqun8lcnq727pkbgla33zzusnlxpupns/2025_08_25_221_ORG_Ob_utverzhdenii_instruktsii_o_vzyatii_pomeshchenii_.pdf)]. –¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏ –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

## üìë API

### `GET /health`
–ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ "ok": true }`.

### `POST /convert`
–û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç.

- `file`: –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π –¥–æ–∫—É–º–µ–Ω—Ç.
- `out`: `markdown` | `json` | `both` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `both`).
- `langs`: —Å—Ç—Ä–æ–∫–∞ —Å —è–∑—ã–∫–∞–º–∏ OCR (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ru,eng`).
- `max_pages`: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü.

–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ª—É—á—à–∏–π Markdown/JSON, —Å–ø–∏—Å–æ–∫ `trials` —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞, —Ä–∞–∑–º–µ—Ä, –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –∏ —Ç.–¥.).

### `POST /chunk`
–ß–∞–Ω–∫–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º Markdown —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –æ–≤–µ—Ä–ª–∞–ø–∞–º–∏).

## üß≠ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
universal_converter/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements*.txt
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ header_filter.json (–ø—Ä–∏–º–µ—Ä)
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ test_health.py
    ‚îú‚îÄ‚îÄ test_langs_normalization.py
    ‚îî‚îÄ‚îÄ test_ocr_pdf.py
```

## üìå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- –§–∞–π–ª `config/header_filter.json` –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è —à–∞–ø–æ–∫.
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Docling —Å–∫–∞—á–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª–∏ (–µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ –∑–∞–¥–∞–Ω). –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DOCLING_ARTIFACTS_PATH` –∏–ª–∏ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–æ–≥—Ä–µ–π—Ç–µ –∫—ç—à.
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å S3/MinIO –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ —Ç–æ–º–∞.
